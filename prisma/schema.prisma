generator client {
  provider = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  //directUrl = env("DIRECT_URL")
  schemas  = ["initial", "pca", "pvl", "ule"]
}

// >> SCHEMA: initial
enum Ability {
  CREATE
  READ
  UPDATE
  DELETE
  ASSIGN
  @@schema("initial")
}

enum Action {
  CREATE
  DELETE
  GET_ONE
  GET_ALL
  LOGIN
  LOGOUT
  RESTORE
  UPDATE
  @@schema("initial")
}

enum Model {
  initial
  @@schema("initial")
}

enum Resource {
  BENEFICIARY
  INCIDENCE
  USER
  REPORT
  @@schema("initial")
}

enum Status {
  BLOCKED
  FAILED
  SUCCESS
  @@schema("initial")
}

model Access {
  id                            String                          @id @default(uuid())
  permission_id                 String
  role_id                       String
  created_at                    DateTime                        @default(now())
  deleted_at                    DateTime?
  permission                    Permission                      @relation(fields: [permission_id], references: [id])
  role                          Role                            @relation(fields: [role_id], references: [id])
  @@unique([permission_id, role_id])
  @@map("access")
  @@schema("initial")
}

model Assignment {
  id                            String                          @id @default(uuid())
  module_id                     String?
  program_id                    String
  role_id                       String
  user_id                       String
  created_at                    DateTime                        @default(now())
  deleted_at                    DateTime?
  module                        Module?                         @relation(fields: [module_id], references: [id])
  program                       Program                         @relation(fields: [program_id], references: [id])
  role                          Role                            @relation(fields: [role_id], references: [id])
  user                          User                            @relation(fields: [user_id], references: [id])
  @@unique([module_id, program_id, role_id, user_id])
  @@map("assignment")
  @@schema("initial")
}

model Audit {
  id                            String                          @id @default(uuid())
  description                   String
  register_id                   String?
  field                         String?
  preview_content               String?
  new_content                   String?
  user_id                       String?
  created_at                    DateTime                        @default(now())
  deleted_at                    DateTime?
  action                        Action
  model                         Model
  status                        Status                          @default(SUCCESS)
  user                          User?                           @relation(fields: [user_id], references: [id])
  @@index([action])
  @@index([model])
  @@index([status])
  @@index([user_id])
  @@map("audit")
  @@schema("initial")
}

model Permission {
  id                            String                          @id @default(uuid())
  created_at                    DateTime                        @default(now())
  deleted_at                    DateTime?
  action                        Ability
  resource                      Resource
  accesses                      Access[]   
  @@unique([action, resource])
  @@map("permission")
  @@schema("initial")
}

model Program {
  id                            String                          @id @default(uuid())
  name                          String                          @unique
  created_at                    DateTime                        @default(now())
  deleted_at                    DateTime?
  assignments                   Assignment[]
  modules                       Module[]
  @@map("program")
  @@schema("initial")
}

model Module {
  id                            String                          @id @default(uuid())
  name                          String                          @unique
  program_id                    String
  created_at                    DateTime                        @default(now())
  deleted_at                    DateTime?
  program                       Program                         @relation(fields: [program_id], references: [id])
  assignments                   Assignment[]
  @@index([program_id])
  @@unique([name, program_id])
  @@map("module")
  @@schema("initial")
}

model Role {
  id                            String                          @id @default(uuid())
  name                          String                          @unique
  is_super                      Boolean                         @default(false)
  created_at                    DateTime                        @default(now())
  deleted_at                    DateTime?
  accesses                      Access[]  
  assignments                   Assignment[]
  @@map("role")
  @@schema("initial")
}

model User {
  id                            String                          @id @default(uuid())
  username                      String                          @unique
  password                      String
  name                          String
  lastname                      String
  email                         String                          @unique
  dni                           String?                         @unique
  phone                         String?                         @unique
  created_at                    DateTime                        @default(now())
  updated_at                    DateTime                        @updatedAt
  deleted_at                    DateTime?
  assignments                   Assignment[]
  audits                        Audit[]
  @@map("user")
  @@schema("initial")
}

// >> SCHEMA: PCA

enum Modality {
  EATER
  CPOT
  @@schema("pca")
}

enum Sex {
  MALE
  FEMALE
  @@schema("pca")
}

model Center {
  id                String      @id @default(uuid())
  code              String      @unique
  name              String
  address           String?
  members           Int         @default(0)
  members_male      Int         @default(0)
  members_female    Int         @default(0)
  situation         String      
  latitude          Float
  longitude         Float
  created_at        DateTime    @default(now())
  updated_at        DateTime    @updatedAt
  deleted_at        DateTime?
  president_id      String
  directive_id      String
  president         President?  @relation(fields: [president_id], references: [id])
  directive         Directive?  @relation(fields: [directive_id], references: [id])
  @@map("center")
  @@schema("pca")
}

model President {
  id                String      @id @default(uuid())
  name              String
  lastname          String
  dni               String?
  sex               Sex
  phone             String?
  birthday          String?
  created_at        DateTime    @default(now())
  updated_at        DateTime    @updatedAt
  deleted_at        DateTime?
  centers           Center[]
  @@map("president")
  @@schema("pca")
}

model Directive {
  id                String      @id @default(uuid())
  resolution        String      
  start_at          DateTime?
  end_at            DateTime?
  created_at        DateTime    @default(now())
  updated_at        DateTime    @updatedAt
  deleted_at        DateTime?
  centers           Center[]
  @@map("directive")
  @@schema("pca")
}



// >> SCHEMA: PVL
enum Route {
  A
  B
  C
  D
  @@schema("pvl")
}


model Committee {
  id                            String                          @id @default(uuid())
  code                          String                          @unique
  name                          String  
  address                       String?
  latitude                      Float
  longitude                     Float
  beneficiaries                 Int                             @default(0)
  beneficiaries_foreign         Int                             @default(0)
  members                       Int                             @default(0)
  handicappeds                  Int                             @default(0)
  commune                       Int                             @default(0)
  observation                   String?
  coordinator_id                String
  couple_id                     String
  town_id                       String
  route                         Route
  coordinator                   Coordinator                     @relation(fields: [coordinator_id], references: [id])
  couple                        Couple                          @relation(fields: [couple_id], references: [id])
  town                          Town                            @relation(fields: [town_id], references: [id])
  created_at                    DateTime                        @default(now())
  updated_at                    DateTime                        @updatedAt
  deleted_at                    DateTime?
  @@map("committee")
  @@schema("pvl")
}

model Coordinator {
  id                            String                          @id @default(uuid())
  name                          String
  lastname                      String
  dni                           String?
  phone                         String?
  birthday                      String?
  created_at                    DateTime                        @default(now())
  updated_at                    DateTime                        @updatedAt
  deleted_at                    DateTime?
  comittees                     Committee[]
  @@map("coordinator")
  @@schema("pvl")
}

model Couple {
  id                            String                          @id @default(uuid())
  name                          String                          @unique
  created_at                    DateTime                        @default(now())
  updated_at                    DateTime                        @updatedAt
  deleted_at                    DateTime?
  comittees                     Committee[]
  @@map("couple")
  @@schema("pvl")
}

model Town {
  id                            String                          @id @default(uuid())
  name                          String                          @unique
  created_at                    DateTime                        @default(now())
  updated_at                    DateTime                        @updatedAt
  deleted_at                    DateTime?
  comittees                     Committee[]
  @@map("town")
  @@schema("pvl")
}

// >> SHEME:ULE
model Enrolled{
  id                            String                          @id @default(uuid())
  dni                           String                          @unique
  names                         String
  lastname                      String
  adress                        String?
  program                       Social                          @relation(fields: [program_id], references: [id])
  program_id                    String
  created_at                    DateTime                        @default(now())
  deleted_at                    DateTime?
  @@map("enrolled")
  @@schema("ule")
}
model Social{
  id                            String                          @id @default(uuid())
  name                          String                          @unique
  created_at                    DateTime                        @default(now())
  deleted_at                    DateTime?
  enrolleds                     Enrolled[]
  @@map("social")
  @@schema("ule")
}
model Enumerator{
  id                            String                          @id @default(uuid())
  dni                           String                          @unique
  name                          String
  lastname                      String
  created_at                    DateTime                        @default(now())
  deleted_at                    DateTime?
  @@map("enumerator")
  @@schema("ule")
}